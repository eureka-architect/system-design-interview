# 🛠️ Gutter Pool이란?

## 📌 개요
**Gutter Pool**은 Facebook이 Memcached를 확장할 때 **장애 대응을 위해 추가한 보조 캐싱 시스템**입니다.  
Memcached 서버가 일시적으로 사용 불가능한 경우, 데이터 요청이 데이터베이스(DB)로 몰려 과부하가 발생할 수 있습니다.  
이러한 상황을 방지하기 위해 **Gutter Pool을 사용하여 일부 요청을 임시 처리**합니다.

---

## 🔧 Gutter Pool의 동작 방식
1. **Memcached 장애 발생**  
   - 특정 Memcached 서버가 다운되거나 네트워크 장애로 인해 응답하지 않음.
   
2. **클라이언트 요청 실패 감지**  
   - Memcached 클라이언트가 요청을 보냈지만 응답이 없으면 **해당 키를 Gutter Pool로 전송**.
   
3. **Gutter Pool에서 캐싱된 데이터 제공**  
   - Gutter Pool은 일반 Memcached 서버처럼 동작하며, **임시 데이터를 저장하고 제공**.
   
4. **데이터베이스(DB) 부하 방지**  
   - 기존 Memcached 서버가 복구될 때까지 Gutter Pool이 요청을 처리하여 **DB로의 직접적인 요청을 줄임**.
   
5. **자동 만료**  
   - Gutter Pool에 저장된 데이터는 일정 시간이 지나면 자동 만료되어 원본 캐시 시스템과의 **데이터 불일치를 방지**.

---

## 📌 Gutter Pool의 주요 이점
✅ **백엔드(DB) 보호**  
   - Memcached 장애 시에도 요청이 DB로 직접 전달되지 않아, **DB 과부하를 방지**.  

✅ **빠른 장애 복구**  
   - Memcached 서버 복구 전까지 데이터를 캐싱하여 **서비스 가용성 유지**.  

✅ **균형 잡힌 부하 분산**  
   - 특정 Memcached 서버 장애 시, **다른 서버에 과부하가 집중되는 것을 방지**.  

---

## 📊 Gutter Pool vs 기존 Memcached 장애 처리 방식
| **항목** | **Gutter Pool 사용** | **기존 방식 (Rehashing)** |
|----------|----------------------|--------------------------|
| 장애 발생 시 처리 방식 | 별도 Gutter Pool 서버로 요청 전송 | Memcached 키를 재할당 (Rehashing) |
| 성능 영향 | 기존 서버 부하 증가 없이 동작 | 키 재분배로 인해 일부 서버 과부하 발생 가능 |
| 데이터 손실 가능성 | 일정 시간 동안 데이터 유지 | 장애 서버 복구 후 일부 데이터 손실 가능 |
| 구현 복잡도 | 추가적인 Gutter Pool 서버 필요 | 별도 설정 없이 기존 Memcached만 사용 가능 |

---

## 💡 Facebook에서 Gutter Pool을 도입한 이유
기존 Memcached 장애 처리 방식에서는 **해시 리밸런싱 (Rehashing)** 을 통해 장애가 발생한 서버의 키를 다른 서버로 재분배하는 방식이 사용되었습니다.  
그러나 **일부 인기 키(hot key)** 가 특정 서버로 몰릴 경우, **해당 서버가 과부하로 인해 다시 장애가 발생하는 문제**가 있었습니다.

👉 이를 해결하기 위해 **Gutter Pool을 활용해 일부 요청을 임시 저장하는 방법**을 선택했고,  
👉 이를 통해 **DB 부하를 방지하고, 서비스의 안정성을 높이는 데 성공**했습니다.

---

## ✅ 결론
**Gutter Pool은 Memcached 장애 시 백엔드 DB를 보호하고, 서비스의 안정성을 유지하기 위해 도입된 보조 캐싱 시스템**입니다.  
이를 통해 장애 발생 시에도 **시스템이 원활하게 작동하고, 사용자는 지연 없이 데이터를 조회**할 수 있습니다. 🚀
